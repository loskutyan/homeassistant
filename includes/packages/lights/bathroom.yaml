bathroom_lights:
  automation:
    - id: 'Свет при движении в ванной'
      alias: bathroom_motion_lights_turn_on
      initial_state: true
      trigger:
        - platform: state
          entity_id: binary_sensor.bathroom_motion_sensor_occupancy
          to: 'on'
        - platform: state
          entity_id: binary_sensor.bathroom_door_sensor_contact
          from: 'off'
          to: 'on'
      condition:
        - condition: state
          entity_id:
            - input_boolean.kidsroom_asleep
            - input_boolean.bedroom_asleep
            - switch.bathroom_lights_switch
          state: 'off'
      action:
        - service: switch.turn_on
          entity_id: switch.bathroom_lights_switch

    - id: 'Включение таймера выключения света в ванной'
      alias: bathroom_lights_on_timer_start
      initial_state: true
      trigger:
        - platform: state
          entity_id: switch.bathroom_lights_switch
          to: 'on'
      action:
        - service: timer.start
          entity_id: timer.bathroom_lights_turn_off_without_motion

    - id: 'Выключение таймера выключения света в ванной'
      alias: bathroom_lights_off_timer_finish
      initial_state: true
      trigger:
        - platform: state
          entity_id: switch.bathroom_lights_switch
          to: 'off'
      action:
        - service: timer.finish
          entity_id: timer.bathroom_lights_turn_off_without_motion

    - id: 'Сброс таймера выключения света при движении в ванной'
      alias: bathroom_motion_lights_timer_reset
      initial_state: true
      trigger:
        - platform: state
          entity_id: binary_sensor.bathroom_motion_sensor_occupancy
          to: 'on'
      condition:
        - condition: state
          entity_id: timer.bathroom_lights_turn_off_without_motion
          state: 'active'
      action:
        - service: timer.start
          entity_id: timer.bathroom_lights_turn_off_without_motion

    - id: 'Сброс таймера выключения света после окончания при движении в ванной'
      alias: bathroom_motion_timer_finished_lights_timer_reset
      initial_state: true
      trigger:
        - platform: state
          entity_id: timer.bathroom_lights_turn_off_without_motion
          from: 'active'
          to: 'idle'
      condition:
        - condition: state
          entity_id: binary_sensor.bathroom_motion_sensor_occupancy
          state: 'on'
      action:
        - service: timer.start
          entity_id: timer.bathroom_lights_turn_off_without_motion

    - id: 'Выключение света в ванной, если нет движения'
      alias: bathroom_no_motion_lights_turn_off
      initial_state: true
      trigger:
        - platform: state
          entity_id: timer.bathroom_lights_turn_off_without_motion
          from: 'active'
          to: 'idle'
      condition:
        - condition: state
          entity_id: switch.bathroom_lights_switch
          state: 'on'
        - condition: state
          entity_id: binary_sensor.bathroom_motion_sensor_occupancy
          state: 'off'
      action:
        - service: switch.turn_off
          entity_id: switch.bathroom_lights_switch
