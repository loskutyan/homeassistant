- id: 'Включение лампы Aqara в спальне в будний день утром'
  alias: bedroom_aqara_led_bulb_workday_morning_turn_on
  initial_state: true
  trigger:
    - platform: time
      at: '09:30'
  condition:
    - condition: state
      entity_id: light.bedroom_aqara_led_bulb
      state: 'off'
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'on'
    - condition: state
      entity_id: input_boolean.somebody_home
      state: 'on'
  action:
    - service: light.turn_on
      entity_id: light.bedroom_aqara_led_bulb
      data:
        brightness: 51
        color_temp: 325
        transition: 5
    - service: timer.start
      entity_id: timer.bedroom_aqara_led_bulb_brightness_increase_interval

- id: 'Включение лампы Aqara в спальне в выходной день утром'
  alias: bedroom_aqara_led_bulb_weekend_morning_turn_on
  initial_state: true
  trigger:
    - platform: time
      at: '10:30'
  condition:
    - condition: state
      entity_id: light.bedroom_aqara_led_bulb
      state: 'off'
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'off'
    - condition: state
      entity_id: input_boolean.somebody_home
      state: 'on'
  action:
    - service: light.turn_on
      entity_id: light.bedroom_aqara_led_bulb
      data:
        brightness: 51
        color_temp: 325
        transition: 5
    - service: timer.start
      entity_id: timer.bedroom_aqara_led_bulb_brightness_increase_interval

- id: 'Прибавление яркости лампы Aqara в спальне утром'
  alias: bedroom_aqara_led_bulb_morning_increase_brightness
  initial_state: true
  trigger:
    - platform: state
      entity_id: timer.bedroom_aqara_led_bulb_brightness_increase_interval
      from: 'active'
      to: 'idle'
  condition:
    - condition: state
      entity_id: light.bedroom_aqara_led_bulb
      state: 'on'
    - condition: numeric_state
      entity_id: light.bedroom_aqara_led_bulb
      attribute: brightness
      below: 154
  action:
    - service: light.turn_on
      entity_id: light.bedroom_aqara_led_bulb
      data:
        brightness: >
          {{ min(state_attr('light.bedroom_aqara_led_bulb', 'brightness') + 5, 255) }}
        color_temp: >
          {{ max(state_attr('light.bedroom_aqara_led_bulb', 'color_temp') - 7, 150) }}
        transition: 5
    - service: timer.start
      entity_id: timer.bedroom_aqara_led_bulb_brightness_increase_interval

- id: 'Включение лампы Aqara в спальне вечером'
  alias: bedroom_aqara_led_bulb_evening_turn_on
  initial_state: true
  trigger:
    - platform: state
      entity_id: input_boolean.somebody_home
      to: 'on'
    - platform: numeric_state
      entity_id: sun.sun
      attribute: elevation
      below: 4
  condition:
    - condition: state
      entity_id: input_boolean.somebody_home
      state: 'on'
    - condition: numeric_state
      entity_id: sun.sun
      attribute: elevation
      below: 4
    - condition: state
      entity_id: light.bedroom_aqara_led_bulb
      state: 'off'
  action:
    - service: light.turn_on
      entity_id: light.bedroom_aqara_led_bulb
      data:
        brightness: 230
        color_temp: 325
        transition: 2

- id: 'Убавление яркости лампы Aqara в спальне вечером'
  alias: bedroom_aqara_led_bulb_evening_decrease_brightness
  initial_state: true
  trigger:
    - platform: time
      at: '00:00'
  condition:
    - condition: state
      entity_id: light.bedroom_aqara_led_bulb
      state: 'on'
  action:
    - service: light.turn_on
      entity_id: light.bedroom_aqara_led_bulb
      data:
        brightness: 192
        color_temp: 360
        transition: 5

- id: 'Минимальная яркость лампы Aqara в спальне вечером'
  alias: bedroom_aqara_led_bulb_evening_min_brightness
  initial_state: true
  trigger:
    - platform: time
      at: '01:00'
  condition:
    - condition: state
      entity_id: light.bedroom_aqara_led_bulb
      state: 'on'
  action:
    - service: light.turn_on
      entity_id: light.bedroom_aqara_led_bulb
      data:
        brightness: 154
        color_temp: 395
        transition: 5

- id: 'Включение/выключение лампы Aqara в спальне'
  alias: bedroom_aqara_led_bulb_button_toggle
  initial_state: true
  trigger:
    - platform: state
      entity_id: sensor.bedroom_aqara_button_action
      to: 'single'
    - platform: state
      entity_id: sensor.bedroom_lights_switch_action
      to: 'single_left'
  action:
    - service: light.toggle
      entity_id: light.bedroom_aqara_led_bulb
      data:
        transition: 2
      
- id: 'Прибавление яркости лампы Aqara в спальне'
  alias: bedroom_aqara_led_bulb_button_add_brightness
  initial_state: true
  trigger:
    - platform: state
      entity_id: sensor.bedroom_aqara_button_action
      to: 'double'
  condition:
    - condition: state
      entity_id: light.bedroom_aqara_led_bulb
      state: 'on'
  action:
    - service: light.turn_on
      entity_id: light.bedroom_aqara_led_bulb
      data_template:
        brightness: >
          {{ min(state_attr('light.bedroom_aqara_led_bulb', 'brightness') + 51, 255) }}
        transition: 1
